<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Collar temperature and ambient temperature | Fine-Scale Tracking of Ambient Temperature and Movement Reveals Shuttling Behavior of Elephants to Water</title>
  <meta name="description" content="Source code for Thaker, Gupte et al. (2019)" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Collar temperature and ambient temperature | Fine-Scale Tracking of Ambient Temperature and Movement Reveals Shuttling Behavior of Elephants to Water" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Source code for Thaker, Gupte et al. (2019)" />
  <meta name="github-repo" content="pratikunterwegs/elephantTempKruger" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Collar temperature and ambient temperature | Fine-Scale Tracking of Ambient Temperature and Movement Reveals Shuttling Behavior of Elephants to Water" />
  
  <meta name="twitter:description" content="Source code for Thaker, Gupte et al. (2019)" />
  

<meta name="author" content="Maria Thaker, Pratik R. Gupte, Herbert HT Prins, Rob Slotow, and Abi T. Vanak" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="supplementary-material.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.1</b> Contact</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html"><i class="fa fa-check"></i><b>2</b> Collar temperature and ambient temperature</a><ul>
<li class="chapter" data-level="2.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#load-libraries"><i class="fa fa-check"></i><b>2.1</b> Load libraries</a></li>
<li class="chapter" data-level="2.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#load-tracking-and-temperature-data"><i class="fa fa-check"></i><b>2.2</b> Load tracking and temperature data</a></li>
<li class="chapter" data-level="2.3" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#select-ele-data-near-tower"><i class="fa fa-check"></i><b>2.3</b> Select ele data near tower</a><ul>
<li class="chapter" data-level="2.3.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#convert-to-sf-and-filter"><i class="fa fa-check"></i><b>2.3.1</b> Convert to <code>sf</code> and filter</a></li>
<li class="chapter" data-level="2.3.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#clean-filtered-data"><i class="fa fa-check"></i><b>2.3.2</b> Clean filtered data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#combine-collar-and-ambient-temp"><i class="fa fa-check"></i><b>2.4</b> Combine collar and ambient temp</a><ul>
<li class="chapter" data-level="2.4.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-data-for-bland-altman"><i class="fa fa-check"></i><b>2.4.1</b> Prepare data for Bland-Altman</a></li>
<li class="chapter" data-level="2.4.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-fig.-3-a-daily-temperature-trend"><i class="fa fa-check"></i><b>2.4.2</b> Prepare Fig. 3 (A): Daily temperature trend</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#exploring-collar-and-ambient-temp"><i class="fa fa-check"></i><b>2.5</b> Exploring collar and ambient temp</a><ul>
<li class="chapter" data-level="2.5.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-data-for-models"><i class="fa fa-check"></i><b>2.5.1</b> Prepare data for models</a></li>
<li class="chapter" data-level="2.5.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#run-models-per-hour"><i class="fa fa-check"></i><b>2.5.2</b> Run models per hour</a></li>
<li class="chapter" data-level="2.5.3" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-data-for-plotting"><i class="fa fa-check"></i><b>2.5.3</b> Prepare data for plotting</a></li>
<li class="chapter" data-level="2.5.4" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-bland-altman-plots"><i class="fa fa-check"></i><b>2.5.4</b> Prepare Bland-Altman plots</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#model-collar-and-ambient-temp"><i class="fa fa-check"></i><b>2.6</b> Model collar and ambient temp</a><ul>
<li class="chapter" data-level="2.6.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#lmm-collar-and-ambient-temp"><i class="fa fa-check"></i><b>2.6.1</b> LMM collar and ambient temp</a></li>
<li class="chapter" data-level="2.6.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#get-variance-components"><i class="fa fa-check"></i><b>2.6.2</b> Get variance components</a></li>
<li class="chapter" data-level="2.6.3" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-figure-3-b-collar-ambient-temperature"><i class="fa fa-check"></i><b>2.6.3</b> Prepare Figure 3 (B): Collar ~ ambient temperature</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#global-bland-altman-test"><i class="fa fa-check"></i><b>2.7</b> Global Bland-Altman test</a><ul>
<li class="chapter" data-level="2.7.1" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-data-for-global-bland-altman"><i class="fa fa-check"></i><b>2.7.1</b> Prepare data for global Bland-Altman</a></li>
<li class="chapter" data-level="2.7.2" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#gamm-for-bland-altman-trend"><i class="fa fa-check"></i><b>2.7.2</b> GAMM for Bland-Altman trend</a></li>
<li class="chapter" data-level="2.7.3" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#prepare-fig.-3-c-bland-altman-plot"><i class="fa fa-check"></i><b>2.7.3</b> Prepare Fig. 3 (C): Bland-Altman plot</a></li>
<li class="chapter" data-level="2.7.4" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#write-hourly-model-summaries-to-file"><i class="fa fa-check"></i><b>2.7.4</b> Write hourly model summaries to file</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="collar-temperature-and-ambient-temperature.html"><a href="collar-temperature-and-ambient-temperature.html#figure-3-collar-and-ambient-temperature"><i class="fa fa-check"></i><b>2.8</b> Figure 3: Collar and ambient temperature</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="supplementary-material.html"><a href="supplementary-material.html"><i class="fa fa-check"></i><b>3</b> Supplementary material</a><ul>
<li class="chapter" data-level="3.1" data-path="supplementary-material.html"><a href="supplementary-material.html#load-libraries-1"><i class="fa fa-check"></i><b>3.1</b> Load libraries</a></li>
<li class="chapter" data-level="3.2" data-path="supplementary-material.html"><a href="supplementary-material.html#load-data"><i class="fa fa-check"></i><b>3.2</b> Load data</a></li>
<li class="chapter" data-level="3.3" data-path="supplementary-material.html"><a href="supplementary-material.html#data-distribution-in-time"><i class="fa fa-check"></i><b>3.3</b> Data distribution in time</a><ul>
<li class="chapter" data-level="3.3.1" data-path="supplementary-material.html"><a href="supplementary-material.html#seasonal-summary"><i class="fa fa-check"></i><b>3.3.1</b> Seasonal summary</a></li>
<li class="chapter" data-level="3.3.2" data-path="supplementary-material.html"><a href="supplementary-material.html#monthly-summary"><i class="fa fa-check"></i><b>3.3.2</b> Monthly summary</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="supplementary-material.html"><a href="supplementary-material.html#elephants-near-the-weather-station"><i class="fa fa-check"></i><b>3.4</b> Elephants near the weather station</a><ul>
<li class="chapter" data-level="3.4.1" data-path="supplementary-material.html"><a href="supplementary-material.html#load-skukuza"><i class="fa fa-check"></i><b>3.4.1</b> Load Skukuza</a></li>
<li class="chapter" data-level="3.4.2" data-path="supplementary-material.html"><a href="supplementary-material.html#select-elephants-within-10-km"><i class="fa fa-check"></i><b>3.4.2</b> Select elephants within 10 km</a></li>
<li class="chapter" data-level="3.4.3" data-path="supplementary-material.html"><a href="supplementary-material.html#get-distribution-over-time"><i class="fa fa-check"></i><b>3.4.3</b> Get distribution over time</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fine-Scale Tracking of Ambient Temperature and Movement Reveals Shuttling Behavior of Elephants to Water</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="collar-temperature-and-ambient-temperature" class="section level1">
<h1><span class="header-section-number">Section 2</span> Collar temperature and ambient temperature</h1>
<div id="load-libraries" class="section level2">
<h2><span class="header-section-number">2.1</span> Load libraries</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># load libraries</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># spatial</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># plotting</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-16" title="16"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb1-17" title="17"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># custom funcs</span></a>
<a class="sourceLine" id="cb1-20" title="20">ci =<span class="st"> </span><span class="cf">function</span>(x) <span class="fl">1.96</span><span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</a></code></pre></div>
</div>
<div id="load-tracking-and-temperature-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Load tracking and temperature data</h2>
<p>Read the tracking data from a number of elephants from 2006 – 2011.</p>
<p>Read in the ambient temperature for approximately the same range, 2007 – 2010.
Handle the date and time columns correctly using lubridate and floor the time to the nearest half hour.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># read in data saved as csv from an excel file</span></a>
<a class="sourceLine" id="cb2-2" title="2">data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/AllEles2011_UTM.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># read in temperature data and select relevant cols</span></a>
<a class="sourceLine" id="cb2-5" title="5">amb_temp =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/skukuza_tower_temp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">c</span>(<span class="st">&quot;date&quot;</span>,<span class="st">&quot;time&quot;</span>,<span class="st">&quot;prop_time&quot;</span>,<span class="st">&quot;col4&quot;</span>,<span class="st">&quot;temp.a&quot;</span>,<span class="st">&quot;col6&quot;</span>,<span class="st">&quot;col7&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">  </span><span class="kw">select</span>(date, prop_time, temp.a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">fast_strptime</span>(date, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>, <span class="dt">lt =</span> F),</a>
<a class="sourceLine" id="cb2-9" title="9">         <span class="dt">time =</span> <span class="kw">as.numeric</span>(date) <span class="op">+</span><span class="st"> </span>prop_time<span class="op">*</span><span class="dv">24</span><span class="op">*</span><span class="dv">3600</span>,</a>
<a class="sourceLine" id="cb2-10" title="10">         <span class="dt">time =</span> <span class="kw">as.POSIXct</span>(time, <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>),</a>
<a class="sourceLine" id="cb2-11" title="11">         <span class="dt">time =</span> <span class="kw">floor_date</span>(time, <span class="dt">unit =</span> <span class="st">&quot;30 minutes&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="st">  </span><span class="kw">select</span>(time, temp.a)</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co"># read in tower location</span></a>
<a class="sourceLine" id="cb2-15" title="15">skukuza =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/skukuza.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="st">  </span><span class="kw">st_transform</span>(<span class="kw">st_crs</span>(<span class="dv">32736</span>))</a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co"># get buffer around skukuza</span></a>
<a class="sourceLine" id="cb2-20" title="20">skz_buf =<span class="st"> </span><span class="kw">st_buffer</span>(skukuza, <span class="dt">dist =</span> <span class="dv">10000</span>)</a></code></pre></div>
</div>
<div id="select-ele-data-near-tower" class="section level2">
<h2><span class="header-section-number">2.3</span> Select ele data near tower</h2>
<div id="convert-to-sf-and-filter" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Convert to <code>sf</code> and filter</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># make ele data spatial</span></a>
<a class="sourceLine" id="cb3-2" title="2">data_sf =<span class="st"> </span><span class="kw">st_as_sf</span>(data, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;XUTM&quot;</span>,<span class="st">&quot;YUTM&quot;</span>))</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">st_crs</span>(data_sf) =<span class="st"> </span><span class="dv">32736</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># which eles are inside the buffer</span></a>
<a class="sourceLine" id="cb3-6" title="6">data_keep =<span class="st"> </span><span class="kw">st_contains</span>(skz_buf, data_sf)</a>
<a class="sourceLine" id="cb3-7" title="7">data_keep =<span class="st"> </span><span class="kw">unlist</span>(data_keep)</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># eles to keep</span></a>
<a class="sourceLine" id="cb3-10" title="10">data_tower =<span class="st"> </span>data[data_keep,]</a></code></pre></div>
</div>
<div id="clean-filtered-data" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Clean filtered data</h3>
<p>Here, process the date and time by converting the <code>Date_Time</code> column to POSIXct.
Then convert <code>time</code> to POSIXct by adding the proportional daily time to the numeric date. Finally, round the time to the nearest half hour. As a sanity check, <em>do the increments of Time_Number follow the increments in time?</em></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">#&#39;clean ele data</span></a>
<a class="sourceLine" id="cb4-2" title="2">data.tow.clean =<span class="st"> </span>data_tower <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">fast_strptime</span>(Date_Time, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>, <span class="dt">lt =</span> F),</a>
<a class="sourceLine" id="cb4-4" title="4">         <span class="dt">time =</span> <span class="kw">as.POSIXct</span>(<span class="kw">as.numeric</span>(date) <span class="op">+</span><span class="st"> </span>TimeNumber<span class="op">*</span><span class="dv">24</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span>, </a>
<a class="sourceLine" id="cb4-5" title="5">                           <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>),</a>
<a class="sourceLine" id="cb4-6" title="6">         <span class="dt">time =</span> <span class="kw">floor_date</span>(time, <span class="st">&quot;30 min&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">temp =</span> TempC)</a></code></pre></div>
</div>
</div>
<div id="combine-collar-and-ambient-temp" class="section level2">
<h2><span class="header-section-number">2.4</span> Combine collar and ambient temp</h2>
<div id="prepare-data-for-bland-altman" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Prepare data for Bland-Altman</h3>
<p>Join the elephant data within 10 km of the tower with ambient temperature data from the tower by the time column. Exploring the data reveals that ambient temperature data records <code>NA</code> as <code>-9999</code>.
Filter the data to exclude these values.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">#&#39;match ele and flux tower</span></a>
<a class="sourceLine" id="cb5-2" title="2">data.tow.clean.ba =<span class="st"> </span>data.tow.clean <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">select</span>(<span class="dt">id =</span> UnitID, time, temp, <span class="dt">season =</span> Season) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">left_join</span>(amb_temp)</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co"># filter combined data</span></a>
<a class="sourceLine" id="cb5-7" title="7">data.tow.clean.ba =<span class="st"> </span>data.tow.clean.ba <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">  </span><span class="kw">filter</span>(temp.a <span class="op">&gt;=</span><span class="st"> </span><span class="dv">-5</span>, <span class="op">!</span><span class="kw">is.na</span>(temp), <span class="op">!</span><span class="kw">is.na</span>(temp.a)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">hour</span>(time), </a>
<a class="sourceLine" id="cb5-10" title="10">         <span class="dt">season =</span> <span class="kw">as_factor</span>(season),</a>
<a class="sourceLine" id="cb5-11" title="11">         <span class="dt">temp =</span> <span class="kw">as.numeric</span>(temp))</a></code></pre></div>
</div>
<div id="prepare-fig.-3-a-daily-temperature-trend" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Prepare Fig. 3 (A): Daily temperature trend</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># make figure of temps per hour of day</span></a>
<a class="sourceLine" id="cb6-2" title="2">data_fig3a =<span class="st"> </span>data.tow.clean.ba <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(hour, season) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp, temp.a), <span class="kw">list</span>(<span class="dt">mean =</span> mean, <span class="dt">ci =</span> ci)) </a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">fig_temp_measure_hour =<span class="st"> </span><span class="kw">ggplot</span>(data_fig3a, <span class="kw">aes</span>(<span class="dt">x =</span> hour))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="st">  </span><span class="kw">geom_rangeframe</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">23</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">40</span>)), <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">y =</span> temp_mean, <span class="dt">col =</span> season), <span class="dt">lty =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">y =</span> temp.a_mean, <span class="dt">col =</span> season), <span class="dt">lty=</span><span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> temp_mean <span class="op">-</span><span class="st"> </span>temp_ci, <span class="dt">ymax =</span> temp_mean <span class="op">+</span><span class="st"> </span>temp_ci, <span class="dt">group =</span> season, <span class="dt">fill =</span> season), <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> temp.a_mean <span class="op">-</span><span class="st"> </span>temp.a_ci, <span class="dt">ymax =</span> temp.a_mean <span class="op">+</span><span class="st"> </span>temp.a_ci, <span class="dt">group =</span> season, <span class="dt">fill =</span> season), <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="st">  </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">12</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">23</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">15</span>,<span class="dv">40</span>,<span class="dv">5</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="st">  </span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb6-25" title="25">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb6-26" title="26">        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">23</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Hour of day&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Temperature (°C)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;(a)&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="exploring-collar-and-ambient-temp" class="section level2">
<h2><span class="header-section-number">2.5</span> Exploring collar and ambient temp</h2>
<div id="prepare-data-for-models" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Prepare data for models</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># load statistical package lme4</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">library</span>(lme4)</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">mean_wo_na =<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">mean</span>(x, <span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb7-5" title="5">sd_wo_na =<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co"># random effects model for within individual and hour std deviation</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># get the mean data</span></a>
<a class="sourceLine" id="cb7-9" title="9">ele.BA.data =<span class="st"> </span><span class="kw">ungroup</span>(data.tow.clean.ba) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> temp<span class="op">-</span>temp.a, <span class="dt">mean.temp =</span> (temp<span class="op">+</span>temp.a)<span class="op">/</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour.plot =</span> <span class="kw">paste</span>(<span class="kw">str_pad</span>(hour, <span class="dv">2</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>), <span class="st">&quot;:00&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a></code></pre></div>
</div>
<div id="run-models-per-hour" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Run models per hour</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># run mods in each hour</span></a>
<a class="sourceLine" id="cb8-2" title="2">ele.BA.mods =<span class="st"> </span><span class="kw">ungroup</span>(ele.BA.data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="st">  </span><span class="kw">split</span>(ele.BA.data<span class="op">$</span>hour.plot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb8-5" title="5">    <span class="kw">lmer</span>(temp <span class="op">~</span><span class="st"> </span>temp.a <span class="op">+</span><span class="st"> </span>season <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>id), <span class="dt">data =</span> x)</a>
<a class="sourceLine" id="cb8-6" title="6">  })</a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co"># prepare predict data</span></a>
<a class="sourceLine" id="cb8-9" title="9">ele.pred.data =<span class="st"> </span>ele.BA.data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="st">  </span><span class="kw">split</span>(ele.BA.data<span class="op">$</span>hour.plot)</a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co"># predict from the model on prepared data</span></a>
<a class="sourceLine" id="cb8-13" title="13">ele.tempmod.fit =<span class="st"> </span><span class="kw">map2</span>(ele.pred.data, ele.BA.mods, <span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb8-14" title="14">  x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">predict</span>(y, <span class="dt">newdata =</span> x, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">se.fit =</span> T))</a>
<a class="sourceLine" id="cb8-16" title="16">}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>()</a></code></pre></div>
</div>
<div id="prepare-data-for-plotting" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Prepare data for plotting</h3>
<p>Extract the variance-correlation components from the hour-wise models using <code>lme4::VarCorr</code>.
Get the standard deviation for each hour.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># summarise model data using multiple maps</span></a>
<a class="sourceLine" id="cb9-2" title="2">ele.ba.summary =<span class="st"> </span>ele.BA.mods <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">map</span>(<span class="dt">.f =</span> VarCorr) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="kw">data_frame</span>(<span class="dt">sd_id =</span> <span class="kw">as.data.frame</span>(x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="st">                 </span>.<span class="op">$</span>sdcor <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="st">                 </span><span class="kw">sum</span>())</a>
<a class="sourceLine" id="cb9-8" title="8">}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">23</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour.plot =</span> <span class="kw">paste</span>(<span class="kw">str_pad</span>(hour, <span class="dv">2</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>), <span class="st">&quot;:00&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co"># get the mean differences from the data prepared for the model</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co"># join to the hour-wise standard deviation</span></a>
<a class="sourceLine" id="cb9-14" title="14">mean_diff =<span class="st"> </span>ele.BA.data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="st">  </span><span class="kw">group_by</span>(hour.plot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">diff =</span> <span class="kw">mean</span>(diff, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="st">  </span><span class="kw">left_join</span>(ele.ba.summary)</a></code></pre></div>
</div>
<div id="prepare-bland-altman-plots" class="section level3">
<h3><span class="header-section-number">2.5.4</span> Prepare Bland-Altman plots</h3>
<p>Plot the hour-wise relationship between collar temperature and ambient temperature, and the hour-wise Bland-Altman plots.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">#&#39;make appendix figure a</span></a>
<a class="sourceLine" id="cb10-2" title="2">fig_temp_rel_hr =<span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw">geom_rangeframe</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">40</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">40</span>)), <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> ele.BA.data, <span class="kw">aes</span>(<span class="dt">x =</span> temp.a, <span class="dt">y =</span> temp), <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> ele.tempmod.fit, <span class="kw">aes</span>(<span class="dt">x =</span> temp.a, <span class="dt">y =</span> pred), <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, </a>
<a class="sourceLine" id="cb10-7" title="7">              <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">40</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>hour.plot, <span class="dt">nrow =</span> <span class="dv">4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">coord_fixed</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ambient temperature (°C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Collar temperature (°C)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;(a)&quot;</span>)</a>
<a class="sourceLine" id="cb10-15" title="15"></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&#39;appendix figure b</span></a>
<a class="sourceLine" id="cb10-17" title="17">fig_ba_hour =<span class="st"> </span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="st">  </span><span class="kw">geom_rangeframe</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">40</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">30</span>)), <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> ele.BA.data, <span class="kw">aes</span>(<span class="dt">x =</span> mean.temp, <span class="dt">y =</span> diff), </a>
<a class="sourceLine" id="cb10-21" title="21">             <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data =</span> mean_diff, <span class="kw">aes</span>(<span class="dt">yintercept =</span> diff), <span class="dt">col =</span> <span class="st">&quot;brown&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data =</span> mean_diff, <span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="fl">1.96</span><span class="op">*</span>sd_id <span class="op">+</span><span class="st"> </span>diff), <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data =</span> mean_diff, <span class="kw">aes</span>(<span class="dt">yintercept =</span> diff <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>sd_id), <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="st">  </span><span class="co">#coord_cartesian(ylim = c(0,40), xlim = c(0,40))+</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">30</span>, <span class="dv">10</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="st">  </span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">40</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>hour.plot, <span class="dt">nrow =</span> <span class="dv">4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="st">  </span><span class="kw">coord_fixed</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mean (amb &amp; collar) temp. (°C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Collar - amb. temp. (°C)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;(b)&quot;</span>)</a>
<a class="sourceLine" id="cb10-36" title="36"></a>
<a class="sourceLine" id="cb10-37" title="37">fig_hourwise_collar_ambient =<span class="st"> </span>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(fig_temp_rel_hr, fig_ba_hour, <span class="dt">nrow =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-38" title="38"></a>
<a class="sourceLine" id="cb10-39" title="39"><span class="kw">ggsave</span>(fig_hourwise_collar_ambient, </a>
<a class="sourceLine" id="cb10-40" title="40">       <span class="dt">filename =</span> <span class="st">&quot;figs/fig_hourwise_collar_ambient.png&quot;</span>, </a>
<a class="sourceLine" id="cb10-41" title="41">       <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">height =</span> <span class="dv">180</span><span class="op">/</span><span class="fl">25.4</span>, <span class="dt">width =</span> <span class="fl">1.5</span><span class="op">*</span><span class="dv">180</span><span class="op">*</span><span class="fl">1.2</span><span class="op">/</span><span class="fl">25.4</span>, <span class="dt">dpi =</span> <span class="dv">300</span>)</a></code></pre></div>
<p><img src="figs/fig_hourwise_collar_ambient.png" width="1913" /></p>
</div>
</div>
<div id="model-collar-and-ambient-temp" class="section level2">
<h2><span class="header-section-number">2.6</span> Model collar and ambient temp</h2>
<div id="lmm-collar-and-ambient-temp" class="section level3">
<h3><span class="header-section-number">2.6.1</span> LMM collar and ambient temp</h3>
<p>Run a global linear mixed effects model for collar temperature as a function of ambient temperature. Write the model summary to a text file.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># run global lmm for collar and ambient temperature</span></a>
<a class="sourceLine" id="cb11-2" title="2">mod.temp =<span class="st"> </span><span class="kw">lmer</span>(temp <span class="op">~</span><span class="st"> </span>temp.a <span class="op">+</span><span class="st"> </span>season <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>hour) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>id), <span class="dt">data =</span> data.tow.clean.ba)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co"># write model summary</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;data/model_output&quot;</span>)){</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">dir.create</span>(<span class="st">&quot;data/model_output&quot;</span>)</a>
<a class="sourceLine" id="cb11-7" title="7">}</a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co"># clear old output</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="st">&quot;data/model_output/model_collar_amb_temp.txt&quot;</span>)){</a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="kw">file.remove</span>(<span class="st">&quot;data/model_output/model_collar_amb_temp.txt&quot;</span>)</a>
<a class="sourceLine" id="cb11-12" title="12">}</a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">R.utils<span class="op">::</span><span class="kw">captureOutput</span>(<span class="kw">summary</span>(mod.temp), </a>
<a class="sourceLine" id="cb11-15" title="15">              <span class="dt">file =</span> <span class="st">&quot;data/model_output/model_collar_amb_temp.txt&quot;</span>,</a>
<a class="sourceLine" id="cb11-16" title="16">              <span class="dt">append =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-17" title="17"></a>
<a class="sourceLine" id="cb11-18" title="18">R.utils<span class="op">::</span><span class="kw">captureOutput</span>(car<span class="op">::</span><span class="kw">Anova</span>(mod.temp),</a>
<a class="sourceLine" id="cb11-19" title="19">                       <span class="dt">file =</span> <span class="st">&quot;data/model_output/model_collar_amb_temp.txt&quot;</span>,</a>
<a class="sourceLine" id="cb11-20" title="20">              <span class="dt">append =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Print the model summary.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;data/model_output/model_collar_amb_temp.txt&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML [&#39;lmerMod&#39;]
Formula: temp ~ temp.a + season + (1 | hour) + (1 | id)
   Data: data.tow.clean.ba

REML criterion at convergence: 77689.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.2505 -0.6336  0.0434  0.6518  5.0781 

Random effects:
 Groups   Name        Variance Std.Dev.
 hour     (Intercept) 12.825   3.581   
 id       (Intercept)  3.865   1.966   
 Residual              7.473   2.734   
Number of obs: 15982, groups:  hour, 24; id, 4

Fixed effects:
             Estimate Std. Error t value
(Intercept) 13.566910   1.254904   10.81
temp.a       0.610849   0.006104  100.07
seasonDry   -1.073253   0.051963  -20.65

Correlation of Fixed Effects:
          (Intr) temp.a
temp.a    -0.117       
seasonDry -0.067  0.365
Analysis of Deviance Table (Type II Wald chisquare tests)

Response: temp
          Chisq Df Pr(&gt;Chisq)    
temp.a 10014.04  1  &lt; 2.2e-16 ***
season   426.59  1  &lt; 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
</div>
<div id="get-variance-components" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Get variance components</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># calculate variance components and print</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co"># variance of random effects</span></a>
<a class="sourceLine" id="cb14-3" title="3">var_eff_hour =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">VarCorr</span>(mod.temp))[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb14-4" title="4">var_eff_Id =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">VarCorr</span>(mod.temp))[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co"># residual</span></a>
<a class="sourceLine" id="cb14-7" title="7">var_res =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">attr</span>(<span class="kw">VarCorr</span>(mod.temp), <span class="st">&quot;sc&quot;</span>)<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-8" title="8"></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co"># fixed effects only</span></a>
<a class="sourceLine" id="cb14-10" title="10">var_fix =<span class="st"> </span><span class="kw">var</span>(<span class="kw">predict</span>(<span class="kw">lm</span>(temp <span class="op">~</span><span class="st"> </span>temp.a <span class="op">+</span><span class="st"> </span>season, <span class="dt">data =</span> data.tow.clean.ba)))</a>
<a class="sourceLine" id="cb14-11" title="11"></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co"># total data variance</span></a>
<a class="sourceLine" id="cb14-13" title="13">var_tot =<span class="st"> </span><span class="kw">var</span>(data.tow.clean.ba<span class="op">$</span>temp)</a>
<a class="sourceLine" id="cb14-14" title="14"></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="co"># proportional variances</span></a>
<a class="sourceLine" id="cb14-16" title="16">p_var =<span class="st"> </span><span class="kw">c</span>(var_eff_hour, var_eff_Id, var_res, var_fix)<span class="op">*</span><span class="dv">100</span><span class="op">/</span>var_tot</a>
<a class="sourceLine" id="cb14-17" title="17"></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="co"># make data frame and save</span></a>
<a class="sourceLine" id="cb14-19" title="19">mod_collar_amb_temp_variance =<span class="st"> </span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="st">  </span><span class="kw">data_frame</span>(<span class="dt">component =</span> <span class="kw">c</span>(<span class="st">&quot;hour&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;residual&quot;</span>, <span class="st">&quot;fixed_effects&quot;</span>),</a>
<a class="sourceLine" id="cb14-21" title="21">             <span class="dt">variance =</span> <span class="kw">c</span>(var_eff_hour, var_eff_Id, var_res, var_fix),</a>
<a class="sourceLine" id="cb14-22" title="22">             <span class="dt">percentage =</span> p_var)</a>
<a class="sourceLine" id="cb14-23" title="23"></a>
<a class="sourceLine" id="cb14-24" title="24"><span class="co"># write to file</span></a>
<a class="sourceLine" id="cb14-25" title="25"><span class="kw">write_csv</span>(mod_collar_amb_temp_variance, </a>
<a class="sourceLine" id="cb14-26" title="26">          <span class="dt">path =</span> <span class="st">&quot;data/model_output/mod_collar_amb_temp_variance.txt&quot;</span>)</a></code></pre></div>
<p>Print the variance components of the model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">variance_comp_temp_amb =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/model_output/mod_collar_amb_temp_variance.txt&quot;</span>)</a>
<a class="sourceLine" id="cb15-2" title="2">knitr<span class="op">::</span><span class="kw">kable</span>(variance_comp_temp_amb)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">component</th>
<th align="right">variance</th>
<th align="right">percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hour</td>
<td align="right">12.824898</td>
<td align="right">27.160790</td>
</tr>
<tr class="even">
<td align="left">id</td>
<td align="right">3.865104</td>
<td align="right">8.185584</td>
</tr>
<tr class="odd">
<td align="left">residual</td>
<td align="right">7.472789</td>
<td align="right">15.826000</td>
</tr>
<tr class="even">
<td align="left">fixed_effects</td>
<td align="right">31.916336</td>
<td align="right">67.592966</td>
</tr>
</tbody>
</table>
</div>
<div id="prepare-figure-3-b-collar-ambient-temperature" class="section level3">
<h3><span class="header-section-number">2.6.3</span> Prepare Figure 3 (B): Collar ~ ambient temperature</h3>
<p>Prepare a figure of the relationship between collar temperature and ambient temperature. This forms <em>figure 3B</em> of the manuscript.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># plot figure of mean relationship collar and ambient temp</span></a>
<a class="sourceLine" id="cb16-2" title="2">fig_temp_rel_data &lt;-<span class="st"> </span>data.tow.clean.ba <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(season, <span class="dt">temp.a =</span> <span class="kw">round</span>(temp.a)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp), <span class="kw">list</span>(<span class="dt">temp_mean =</span> mean, <span class="dt">temp_ci =</span> ci))</a>
<a class="sourceLine" id="cb16-5" title="5">  </a>
<a class="sourceLine" id="cb16-6" title="6">fig_temp_measure_relation &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> fig_temp_rel_data, </a>
<a class="sourceLine" id="cb16-9" title="9">              <span class="kw">aes</span>(<span class="dt">x =</span> temp.a, <span class="dt">y =</span> temp_mean, <span class="dt">group =</span> season, </a>
<a class="sourceLine" id="cb16-10" title="10">                  <span class="dt">col =</span> season, <span class="dt">fill =</span> season), <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, </a>
<a class="sourceLine" id="cb16-11" title="11">              <span class="dt">se =</span>T, <span class="dt">alpha =</span> <span class="fl">0.2</span>,<span class="dt">lwd =</span> <span class="fl">0.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">data =</span> fig_temp_rel_data, </a>
<a class="sourceLine" id="cb16-14" title="14">                  <span class="kw">aes</span>(<span class="dt">x =</span> temp.a, <span class="dt">y =</span>  temp_mean, </a>
<a class="sourceLine" id="cb16-15" title="15">                      <span class="dt">ymin =</span> temp_mean<span class="op">-</span>temp_ci , <span class="dt">ymax =</span> temp_mean<span class="op">+</span>temp_ci, </a>
<a class="sourceLine" id="cb16-16" title="16">                      <span class="dt">shape =</span> season, <span class="dt">col =</span> season), </a>
<a class="sourceLine" id="cb16-17" title="17">                  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), </a>
<a class="sourceLine" id="cb16-18" title="18">                  <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">stroke =</span> <span class="fl">0.4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-19" title="19"><span class="st">  </span><span class="kw">geom_rangeframe</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">40</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">44</span>)), <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="st">  </span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">lty =</span> <span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-22" title="22"></a>
<a class="sourceLine" id="cb16-23" title="23"><span class="st">  </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-24" title="24"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-25" title="25"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">24</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-26" title="26"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">5</span>,<span class="dv">40</span>,<span class="dv">5</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-27" title="27"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">4</span>,<span class="dv">44</span>,<span class="dv">8</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-28" title="28"><span class="st">  </span></a>
<a class="sourceLine" id="cb16-29" title="29"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">40</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">44</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-30" title="30"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb16-31" title="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb16-32" title="32">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb16-33" title="33">        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb16-34" title="34"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ambient temperature (°C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Collar temperature (°C)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;(b)&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="global-bland-altman-test" class="section level2">
<h2><span class="header-section-number">2.7</span> Global Bland-Altman test</h2>
<p>Prepare a global Bland Altman test and associated plots.</p>
<div id="prepare-data-for-global-bland-altman" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Prepare data for global Bland-Altman</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># get data for global BA plot</span></a>
<a class="sourceLine" id="cb17-2" title="2">ele.BA.data =<span class="st"> </span>ele.BA.data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(temp), <span class="op">!</span><span class="kw">is.na</span>(temp.a)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">  </span><span class="kw">group_by</span>(id, hour, season) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp, temp.a), <span class="kw">funs</span>(mean)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean.measures =</span> (temp<span class="op">+</span>temp.a)<span class="op">/</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb17-8" title="8">         <span class="dt">diff.measures =</span> temp<span class="op">-</span>temp.a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">mean.measures =</span> <span class="kw">round</span>(mean.measures), season) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(diff.measures), <span class="kw">funs</span>(mean))</a></code></pre></div>
</div>
<div id="gamm-for-bland-altman-trend" class="section level3">
<h3><span class="header-section-number">2.7.2</span> GAMM for Bland-Altman trend</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># run a gamm of differences vs mean for the BA data</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">library</span>(mgcv)</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4">BA.gam =<span class="st"> </span><span class="kw">gam</span>(diff.measures <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(mean.measures, <span class="dt">by =</span> season), <span class="dt">data =</span> ele.BA.data)</a>
<a class="sourceLine" id="cb18-5" title="5"></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="co"># write summary to file and then read and show</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="co"># clear old output</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="st">&quot;data/model_output/model_gamm_BA.txt&quot;</span>)){</a>
<a class="sourceLine" id="cb18-9" title="9">  <span class="kw">file.remove</span>(<span class="st">&quot;data/model_output/model_gamm_BA.txt&quot;</span>)</a>
<a class="sourceLine" id="cb18-10" title="10">}</a>
<a class="sourceLine" id="cb18-11" title="11"></a>
<a class="sourceLine" id="cb18-12" title="12">R.utils<span class="op">::</span><span class="kw">captureOutput</span>(<span class="kw">summary</span>(BA.gam), </a>
<a class="sourceLine" id="cb18-13" title="13">              <span class="dt">file =</span> <span class="st">&quot;data/model_output/model_gamm_BA.txt&quot;</span>,</a>
<a class="sourceLine" id="cb18-14" title="14">              <span class="dt">append =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="co"># get model predictions</span></a>
<a class="sourceLine" id="cb18-17" title="17">ele.BA.data<span class="op">$</span>pred =<span class="st"> </span><span class="kw">predict</span>(BA.gam, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, </a>
<a class="sourceLine" id="cb18-18" title="18">                           <span class="dt">newdata =</span> ele.BA.data, <span class="dt">se.fit =</span> T)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb18-19" title="19">ele.BA.data<span class="op">$</span>se =<span class="st"> </span><span class="kw">predict</span>(BA.gam, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, </a>
<a class="sourceLine" id="cb18-20" title="20">                         <span class="dt">newdata =</span> ele.BA.data, <span class="dt">se.fit =</span> T)[[<span class="dv">2</span>]]</a></code></pre></div>
<p>Print the GAMM summary.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;data/model_output/model_gamm_BA.txt&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
diff.measures ~ s(mean.measures, by = season)

Parametric coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   4.5342     0.2535   17.89 3.82e-15 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Approximate significance of smooth terms:
                             edf Ref.df     F  p-value    
s(mean.measures):seasonWet 1.593  1.980 11.36  0.00025 ***
s(mean.measures):seasonDry 2.012  2.509 16.46 7.09e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

R-sq.(adj) =  0.704   Deviance explained = 74.4%
GCV = 2.0248  Scale est. = 1.6918    n = 28</code></pre>
</div>
<div id="prepare-fig.-3-c-bland-altman-plot" class="section level3">
<h3><span class="header-section-number">2.7.3</span> Prepare Fig. 3 (C): Bland-Altman plot</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># prepare global bland altman figure</span></a>
<a class="sourceLine" id="cb21-2" title="2">figBArevised =<span class="st"> </span><span class="kw">ggplot</span>(ele.BA.data)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean.measures, <span class="dt">ymin =</span> pred<span class="op">-</span>se, <span class="dt">ymax =</span> pred<span class="op">+</span>se, <span class="dt">fill =</span> season), </a>
<a class="sourceLine" id="cb21-5" title="5">              <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean.measures, <span class="dt">y =</span> pred, <span class="dt">col =</span> season), <span class="dt">lty =</span> <span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean.measures, <span class="dt">y =</span> diff.measures, <span class="dt">col =</span> season, <span class="dt">shape =</span> season), </a>
<a class="sourceLine" id="cb21-9" title="9">             <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>,<span class="dt">stroke =</span> <span class="fl">0.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="dt">direction =</span> <span class="dv">-1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-11" title="11"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb21-12" title="12"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">24</span>,<span class="dv">21</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="st">  </span><span class="kw">geom_rangeframe</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">35</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">20</span>)), <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb21-14" title="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb21-15" title="15"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">mean</span>(mean_diff<span class="op">$</span>diff),  </a>
<a class="sourceLine" id="cb21-16" title="16">                            <span class="kw">mean</span>(mean_diff<span class="op">$</span>diff) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="kw">mean</span>(mean_diff<span class="op">$</span>sd_id),</a>
<a class="sourceLine" id="cb21-17" title="17">                            <span class="kw">mean</span>(mean_diff<span class="op">$</span>diff) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="kw">mean</span>(mean_diff<span class="op">$</span>sd_id)), </a>
<a class="sourceLine" id="cb21-18" title="18">             <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb21-19" title="19">             <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), </a>
<a class="sourceLine" id="cb21-20" title="20">             <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;brown&quot;</span>,<span class="st">&quot;steelblue&quot;</span>,<span class="st">&quot;steelblue&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb21-21" title="21"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb21-22" title="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, </a>
<a class="sourceLine" id="cb21-23" title="23">        <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb21-24" title="24">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb21-25" title="25">        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb21-26" title="26"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">20</span>, <span class="dv">5</span>)))<span class="op">+</span></a>
<a class="sourceLine" id="cb21-27" title="27"><span class="st">  </span></a>
<a class="sourceLine" id="cb21-28" title="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mean (collar &amp; amb.) temp (°C)&quot;</span>, </a>
<a class="sourceLine" id="cb21-29" title="29">       <span class="dt">y =</span> <span class="st">&quot;Collar temp. - amb. temp. (°C)&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;(c)&quot;</span>)</a></code></pre></div>
</div>
<div id="write-hourly-model-summaries-to-file" class="section level3">
<h3><span class="header-section-number">2.7.4</span> Write hourly model summaries to file</h3>
<p>Gather model output for temperature models per hour and write to file.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># hourly model output</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="co"># this is complicated code, please don&#39;t do it this way</span></a>
<a class="sourceLine" id="cb22-3" title="3">ele.temp.mods.summary =<span class="st"> </span>ele.BA.mods <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="st">  </span><span class="kw">map</span>(summary) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb22-6" title="6">    x<span class="op">$</span>coefficients <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-7" title="7"><span class="st">      </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-8" title="8"><span class="st">      </span><span class="kw">select</span>(Estimate, <span class="st">`</span><span class="dt">t value</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-9" title="9"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">predictor =</span> <span class="kw">rownames</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-10" title="10"><span class="st">      </span>tidyr<span class="op">::</span><span class="kw">gather</span>(lmm_output, value, <span class="op">-</span>predictor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-11" title="11"><span class="st">      </span><span class="kw">filter</span>(predictor <span class="op">!=</span><span class="st"> </span>(<span class="st">&quot;(Intercept)&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-12" title="12"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">value =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(value, <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-13" title="13"><span class="st">      </span>tidyr<span class="op">::</span><span class="kw">spread</span>(lmm_output, value)}) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-14" title="14"><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-15" title="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">23</span>, <span class="dt">each =</span> <span class="dv">2</span>), <span class="dt">predictor =</span> <span class="kw">ifelse</span>(predictor <span class="op">!=</span><span class="st"> &quot;temp.a&quot;</span>, <span class="st">&quot;season&quot;</span>, predictor)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-16" title="16"><span class="st">  </span></a>
<a class="sourceLine" id="cb22-17" title="17"><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">map</span>(ele.BA.mods, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb22-18" title="18">    car<span class="op">::</span><span class="kw">Anova</span>(x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-19" title="19"><span class="st">      </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-20" title="20"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">predictor =</span> <span class="kw">rownames</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-21" title="21"><span class="st">      </span><span class="kw">rename</span>(<span class="dt">p_value =</span> <span class="st">`</span><span class="dt">Pr(&gt;Chisq)</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-22" title="22"><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>Df)}) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-23" title="23"><span class="st">      </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-24" title="24"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">23</span>, <span class="dt">each =</span> <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb22-25" title="25">             <span class="dt">Chisq =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(Chisq, <span class="fl">0.1</span>), </a>
<a class="sourceLine" id="cb22-26" title="26">             <span class="dt">p_value =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(p_value, <span class="fl">0.001</span>)))</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># export to csv</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">write_csv</span>(ele.temp.mods.summary, <span class="dt">path =</span> <span class="st">&quot;data/model_output//ele_temp_mods_summary.txt&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="figure-3-collar-and-ambient-temperature" class="section level2">
<h2><span class="header-section-number">2.8</span> Figure 3: Collar and ambient temperature</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">half =<span class="st"> </span><span class="dv">85</span><span class="op">/</span><span class="fl">25.4</span>; full =<span class="st"> </span><span class="dv">180</span><span class="op">/</span><span class="fl">25.4</span></a>
<a class="sourceLine" id="cb24-2" title="2"></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="co"># export fig for temp measures</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb24-5" title="5"></a>
<a class="sourceLine" id="cb24-6" title="6">figure_<span class="dv">03</span>_temperature_sources =<span class="st"> </span><span class="kw">grid.arrange</span>(fig_temp_measure_hour, fig_temp_measure_relation, figBArevised, <span class="dt">nrow =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb24-7" title="7"></a>
<a class="sourceLine" id="cb24-8" title="8"><span class="kw">ggsave</span>(figure_<span class="dv">03</span>_temperature_sources,</a>
<a class="sourceLine" id="cb24-9" title="9">       <span class="dt">filename =</span> <span class="st">&quot;figs/figure_03_temperature_sources.pdf&quot;</span>,</a>
<a class="sourceLine" id="cb24-10" title="10">       <span class="dt">height =</span> half, <span class="dt">width =</span> full)</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">library</span>(magick)</a>
<a class="sourceLine" id="cb25-2" title="2">fig03 =<span class="st"> </span>magick<span class="op">::</span><span class="kw">image_read_pdf</span>(<span class="st">&quot;figs/figure_03_temperature_sources.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb25-3" title="3">fig03</a></code></pre></div>
<div class="figure">
<img src="elephant_temp_kruger_2019_files/figure-html/show_figure_03-1.png" alt="**(a)** Mean collar temperature (solid lines) and measured ambient temperature from Skukuza flux tower (dashed lines) at each hour of day in each season (dry: red lines, wet: blue lines) over the study period. Ninety-Five percent confidence intervals (CI) about each line are shaded. **(b)** Correlation between mean collar temperature from elephants within 10 km of the Skukuza flux tower (from n = 3 elephants) and time-matched ambient temperatures measured by the flux tower in each season (dry: red circles, wet: blue triangles). The dashed line denotes the line of identity where collar temperature equals ambient temperature. Bars represent 95% CI at each point. **(c)** Bland-Altman limits of agreement plot comparing collar temperatures and ambient temperatures from the Skukuza flux tower, accounting for repeated measures of individual elephants and hour of day (n = 28,853 total comparisons). The bias between the two measures at each mean temperature is marked by symbols colored by season (dry: red circles, wet: blue triangles). The black dashed line marks zero difference between the two measures. The upper and lower limits of agreement are shown as the standard normal deviate (1.96) times the standard deviation due to elephant identity, and are marked by solid blue lines, while the mean difference in measures is marked by the solid red line." width="1062" />
<p class="caption">
(#fig:show_figure_03)<strong>(a)</strong> Mean collar temperature (solid lines) and measured ambient temperature from Skukuza flux tower (dashed lines) at each hour of day in each season (dry: red lines, wet: blue lines) over the study period. Ninety-Five percent confidence intervals (CI) about each line are shaded. <strong>(b)</strong> Correlation between mean collar temperature from elephants within 10 km of the Skukuza flux tower (from n = 3 elephants) and time-matched ambient temperatures measured by the flux tower in each season (dry: red circles, wet: blue triangles). The dashed line denotes the line of identity where collar temperature equals ambient temperature. Bars represent 95% CI at each point. <strong>(c)</strong> Bland-Altman limits of agreement plot comparing collar temperatures and ambient temperatures from the Skukuza flux tower, accounting for repeated measures of individual elephants and hour of day (n = 28,853 total comparisons). The bias between the two measures at each mean temperature is marked by symbols colored by season (dry: red circles, wet: blue triangles). The black dashed line marks zero difference between the two measures. The upper and lower limits of agreement are shown as the standard normal deviate (1.96) times the standard deviation due to elephant identity, and are marked by solid blue lines, while the mean difference in measures is marked by the solid red line.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="supplementary-material.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/elephantTempKruger/edit/master/03_colllar_ambient_temp.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
