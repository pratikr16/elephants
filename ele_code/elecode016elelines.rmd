# Ele lines

```{r}
load("eles_basic.rdata")
source("libs.R")
```


```{r}
library(sp)

#'split by id and season

ele.lines = ele %>% mutate(year = year(time)) %>%  dlply(c("id","season2","year")) %>% 
  map(function(x) Line(cbind(x$xutm, x$yutm)))

ele.lines = ele.lines %>% 
  map(function(x) Lines(x, ID = "a"))

for(i in 1:length(ele.lines)){
  ele.lines[[i]]@ID = names(ele.lines)[i]
}

names = names(ele.lines)

ele.lines = SpatialLines(ele.lines, proj4string = CRS("+proj=utm +zone=36 +south +datum=WGS84 +units=m +no_defs"))

library(stringi)

data = data.frame(cbind(id = 1:length(ele.lines), name = names, ele = stri_extract(names, regex='[^.]*'), season = unlist(stri_extract_all_regex(names, '\\p{Ll}+'))))

rownames(data) = names

ele.lines = SpatialLinesDataFrame(ele.lines, data = data)

#'export
library(rgdal)
writeOGR(ele.lines, dsn = ".", layer = "ele.lines.season", driver = "ESRI Shapefile", overwrite_layer = T)
```

# Ele loops


```{r}
library(sp)

#'split by id and season

ele.lines = ele5 %>% bind_rows() %>% arrange(id, time) %>%  dlply(c("id","loop")) %>%
  map(function(x) Line(cbind(x$xutm, x$yutm)))

ele.lines = ele.lines %>%
  map(function(x) Lines(x, ID = "a"))

for(i in 1:length(ele.lines)){
  ele.lines[[i]]@ID = names(ele.lines)[i]
}

names = names(ele.lines)

ele.lines = SpatialLines(ele.lines, proj4string = CRS("+proj=utm +zone=36 +south +datum=WGS84 +units=m +no_defs"))

library(stringi)

data = data.frame(cbind(id = 1:length(ele.lines), name = names, ele = stri_extract(names, regex='[^.]*'), loop = as.numeric(sub('.*\\.', '', names))))

data$loop = as.numeric(as.character(data$loop))

rownames(data) = names

ele.lines = SpatialLinesDataFrame(ele.lines, data = data)

#'export
library(rgdal)
writeOGR(ele.lines, dsn = ".", layer = "ele.loops", driver = "ESRI Shapefile", overwrite_layer = T)
```