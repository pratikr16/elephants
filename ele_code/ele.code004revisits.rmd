
  
# Load libs
  
```{r load_libs, message=FALSE, warning=FALSE}
#set env
source("libs.R")
source("ggplot.opts.r")
```

```{r source_data}
#'load raw eles and make a move object (useful)
#source("ele.code002.5dataloading.r")
#source("ele.move.r")

```

```{r load_spatial_libs}
library(sp); library(rgdal); library(proj4)

library(recurse)
```


# Prep data

```{r prep_eles, eval=FALSE, include=FALSE}

#'split into list by id, and subsample only half points
ele.utm = ele %>% dlply("id") %>%
  map(function(x) x %>% dplyr::select(xutm, yutm, time, id) %>% arrange(time) %>% sample_frac(0.5))

write.csv(ele.utm, file = "for-recurse.csv", row.names = F)

rm(list = ls())
.rs.restartR()
```

# Get recurse

```{r recurse_eles}
#'use get recursions at 500m. eles need to be recursed one at a time.
# THE ORDER OF THE VARIABLES IN THE DATA FRAME MATTERS: X, Y, TIME, ID

ele.utm = readr::read_csv("for-recurse.csv")
library(recurse)

ele.utm = data.frame(ele.utm)
#fewest.points = which.min(lapply(ele.utm, function(x) dim(x)[1]))

ele.utm = ele.utm %>% dlply("id") %>% map(function(x) arrange(x, time))
```

```{r}
#AM306.recurse = getRecursions(ele.utm[[fewest.points]], radius = 1000, timeunits = "hours")

for(i in 1:14){
  source("libs.R")
  ele.utm = readr::read_csv("for-recurse.csv")
library(recurse)

ele.utm = data.frame(ele.utm)
#fewest.points = which.min(lapply(ele.utm, function(x) dim(x)[1]))

ele.utm = ele.utm %>% dlply("id") %>% map(function(x) arrange(x, time))

  ele.recurse = getRecursions(ele.utm[[i]], radius = 1000, timeunits = "hours")
  
  write.csv(ele.recurse$revisitStats, file = paste("recurse",i,".csv", sep ="_" ), row.names = F)
  rm(list = ls(all.names = T))
  gc()
}

```

# load context rivers and whs

```{r}
library(sf)
wh = st_read("~/git/elephants/ele_data/gis_etc/Kruger Updated GIS Layers/waterpoints_zambatis_2011.shp")

#plot(wh, col = wh$CURRENT)

wh = wh %>% filter(CURRENT=="Open")

rivers = st_read("~/git/elephants/ele_data/gis_etc/Kruger Updated GIS Layers/rivers_main.shp")

river.buffer = st_buffer(rivers, dist = 500)
wh.buffer = st_buffer(wh, dist = 500)
```


